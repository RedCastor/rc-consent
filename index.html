<!doctype html>
<html class="no-js" lang="en-US">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Angular Directive Cookie.</title>

    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.0/css/foundation-float.css"/>

    <script type="text/javascript" src="src/rc-consent.js"></script>
    <script type="text/javascript" id="rcc_consent_GA">
        window.addEventListener("load", function() {
            window.rcc.addProvider({
                id: 'ga',
                trackingId: 'UA-128378883-1',
                anonymizeIp: true,
                load: function() {
                    if (typeof ga !== 'undefined') { return false; }
                    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                },
                onInitialise: function (rcc, status) {
                    console.log('GA Consent init');

                    if (rcc.hasConsented(this.category)) {
                        console.log('hasConsented: true');
                    }
                    else {
                        console.log('hasConsented: false');
                    }
                },
                onAllow: function (rcc) {
                    console.log('GA consent allow:' + this.category);

                    this.load();
                    ga('create', this.trackingId, 'auto');
                    ga('set', 'anonymizeIp', this.anonymizeIp);
                    ga('send', 'event', 'Cookie Consent', 'Accepted');
                    ga('send', 'pageview');
                },
                onRevoke: function (rcc) {
                    console.log('GA consent revoke:' + this.category);

                    this.load();

                    ga('create', this.trackingId, {'storage': 'none'});
                    ga('send', 'event', 'Cookie Consent', 'Declined');
                }
            });
        });
    </script>
    <script type="text/javascript" id="rcc_consent_ADS">
        window.addEventListener("load", function() {
            window.rcc.addProvider({
                id: 'ads',
                category: 'marketing',
                onInitialise: function (rcc, status) {
                    console.log('ADS Consent init');

                    if (rcc.hasConsented(this.category)) {
                        console.log('hasConsented: true');
                    }
                    else {
                        console.log('hasConsented: false');
                    }
                },
                onAllow: function (rcc) {
                    console.log('ADS consent allow:' + this.category);
                },
                onRevoke: function (rcc) {
                    console.log('ADS consent revoke:' + this.category);
                }
            });
        });
    </script>
    <script type="text/javascript" id="rcc_consent_hotjar">
        window.addEventListener("load", function() {
            window.rcc.addProvider({
                id: 'hotjar',
                category: 'required',
                load: function () {
                    (function(h,o,t,j,a,r){
                        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
                        h._hjSettings={hjid:1070708,hjsv:6};
                        a=o.getElementsByTagName('head')[0];
                        r=o.createElement('script');r.async=1;
                        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
                        a.appendChild(r);
                    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
                },
                onInitialise: function (rcc, status) {
                    console.log('HOTJAR Consent init');

                    if (rcc.hasConsented(this.category)) {
                        console.log('hasConsented: true');
                    }
                    else {
                        console.log('hasConsented: false');
                    }
                },
                onAllow: function (rcc) {
                    console.log('HOTJAR consent allow:' + this.category);

                    this.load();
                },
                onRevoke: function (rcc) {
                    console.log('HOTJAR consent revoke:' + this.category);
                }
            });
        });
    </script>
    <script>
        window.addEventListener("load", function() {
            window.rcc.initialise({formIds: ['consent_form'], clickSelector: '.rcc-consent-button', cookie: {name: 'consent'}, defaultStatus: {required: true}});
        });
    </script>

    <style>
        .switch-toggle-wrapper {
            display: flex;
            margin-bottom: 1rem;
            justify-content: space-between;
            align-items: center;
        }

        .switch-toggle-wrapper .switch {
            margin-bottom: 0;
        }
    </style>
</head>

<body data-ng-app="app" >
<!--[if lt IE 9]>
<div class="alert alert-warning browserupgrade">
    You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.
</div>
<![endif]-->
<main>
    <div>
        <br>
        <div class="row">
            <div class="small-12 medium-6 columns medium-centered">
                <div class="reveal" id="consentModal" data-reveal data-close-on-click="false" data-close-on-esc="false">
                    <section class="card">
                        <header class="card-divider">
                            <h4 class="page-header">Consent Form</h4>
                        </header>
                        <form id="consent_form" novalidate name="consentForm" class="card-section cookie-form" >
                            <div class="switch-toggle-wrapper">
                                <div class="switch tiny">
                                    <input class="switch-input" id="tinySwitchRequired"  name="required" type="checkbox">
                                    <label class="switch-paddle" for="tinySwitchRequired">
                                        <span class="show-for-sr">Required</span>
                                        <span class="switch-active" aria-hidden="true">Yes</span>
                                        <span class="switch-inactive" aria-hidden="true">No</span>
                                    </label>
                                </div>
                                <span>Required</span>
                            </div>

                            <div class="switch-toggle-wrapper">
                                <div class="switch tiny">
                                    <input class="switch-input" id="tinySwitchAnalytics"  name="analytics" type="checkbox">
                                    <label class="switch-paddle" for="tinySwitchAnalytics">
                                        <span class="show-for-sr">Analytics</span>
                                        <span class="switch-active" aria-hidden="true">Yes</span>
                                        <span class="switch-inactive" aria-hidden="true">No</span>
                                    </label>
                                </div>
                                <span>Analytics</span>
                            </div>

                            <div class="switch-toggle-wrapper">
                                <div class="switch tiny">
                                    <input class="switch-input" id="tinySwitchMarketing"  name="marketing" type="checkbox">
                                    <label class="switch-paddle" for="tinySwitchMarketing">
                                        <span class="show-for-sr">Marketing</span>
                                        <span class="switch-active" aria-hidden="true">Yes</span>
                                        <span class="switch-inactive" aria-hidden="true">No</span>
                                    </label>
                                </div>
                                <span>Marketing</span>
                            </div>

                            <input type="submit" class="button primary" value="Accept">
                        </form>
                    </section>
                </div>

                <p><button class="button" data-open="consentModal" >Cookie Policy</button></p>
            </div>
        </div>
    </div>
</main>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.0/js/foundation.js"></script>
<script type="text/javascript">
    (function($, rcc) {
        "use strict";

        var $consentModal = $('#consentModal');
        var $consentModalInstance = new Foundation.Reveal($consentModal);

        //Check has consented
        $(window).on("load", function() {

            if (!rcc.hasConsented()) {
                $consentModal.foundation('open');
            }
        });

        //On Submit close modal
        $('#consent_form').submit(function (e) {

            $consentModal.foundation('close');

            return false;
        });

        //Init form field on Modal Open
        $consentModal.on('open.zf.reveal', function () {

            var consent_status = rcc.getStatus();

            $( 'input[name][type="checkbox"]' ).each(function( index ) {

                $( this ).attr("checked", (consent_status[this.name] === true ? true : false));
            });


        });

    })(jQuery, rcc);
</script>
</body>
</html>